<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/react-guides/src/react-guides/Guides.tsx - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/daybrush.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="description" content="packages/react-guides/src/react-guides/Guides.tsx - Documentation"/>

</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h2 class="custom"><a href="https://github.com/daybrush/selecto" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><div class="search"><div class="input-area"><input type="text"/></div><button></button></div><ul class="classes"><li file="guides" class="parent"><a href="Guides.html">Guides</a><h4><a href="Guides.html#methods">Methods</a></h4><ul class='methods'><li data-type='method'><a href="Guides.html#destroy">destroy</a></li><li data-type='method'><a href="Guides.html#getGuides">getGuides</a></li><li data-type='method'><a href="Guides.html#loadGuides">loadGuides</a></li><li data-type='method'><a href="Guides.html#resize">resize</a></li><li data-type='method'><a href="Guides.html#scroll">scroll</a></li><li data-type='method'><a href="Guides.html#scrollGuides">scrollGuides</a></li><li data-type='method'><a href="Guides.html#setState">setState</a></li></ul><h4><a href="Guides.html#events">Events</a></h4><ul class='events'><li data-type='event'><a href="Guides.html#.event:changeGuides">changeGuides</a></li></ul><h4><a href="Guides.html#type definitions">Type Definitions</a></h4><ul class='type definitions'><li data-type='typddef'><a href="Guides.html#.GuidesOptions">GuidesOptions</a></li></ul></li><li file="component" class="parent"><a href="eg.Component.html">eg.Component</a><h4><a href="eg.Component.html#static members">Static Members</a></h4><ul class='static members'><li data-type='member'><a href="eg.Component.html#.VERSION">VERSION</a></li></ul><h4><a href="eg.Component.html#methods">Methods</a></h4><ul class='methods'><li data-type='method'><a href="eg.Component.html#hasOn">hasOn</a></li><li data-type='method'><a href="eg.Component.html#off">off</a></li><li data-type='method'><a href="eg.Component.html#on">on</a></li><li data-type='method'><a href="eg.Component.html#once">once</a></li><li data-type='method'><a href="eg.Component.html#trigger">trigger</a></li></ul></li></ul><ul class="global"><li file="global"  class="parent"><a href="global.html">Global</a><h4><a href="global.html#methods">Methods</a></h4><ul class='methods'><li data-type='method'><a href="global.html#isUndefined">isUndefined</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">packages/react-guides/src/react-guides/Guides.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as React from "react";
import Ruler from "@scena/react-ruler";
import { ref, refs } from "framework-utils";
import Dragger from "@daybrush/drag";
import styled, { StyledInterface } from "react-css-styled";
import { GUIDES, GUIDE, DRAGGING, ADDER, DISPLAY_DRAG, GUIDES_CSS } from "./consts";
import { prefix } from "./utils";
import { hasClass, addClass, removeClass } from "@daybrush/utils";
import { GuidesState, GuidesProps, GuidesInterface } from "./types";

const GuidesElement = styled("div", GUIDES_CSS);

export default class Guides extends React.PureComponent&lt;GuidesProps, GuidesState> implements GuidesInterface {
    public static defaultProps: GuidesProps = {
        className: "",
        type: "horizontal",
        setGuides: () => { },
        zoom: 1,
        style: { width: "100%", height: "100%" },
        snapThreshold: 5,
        snaps: [],
        onChangeGuides: () => {},
        displayDragPos: false,
        dragPosFormat: v => v,
    };
    public state: GuidesState = {
        guides: [],
    };
    public adderElement!: HTMLElement;
    public scrollPos: number = 0;
    public ruler!: Ruler;
    private manager!: StyledInterface;
    private guidesElement!: HTMLElement;
    private displayElement!: HTMLElement;
    private dragger!: Dragger;
    private guideElements: HTMLElement[] = [];

    public render() {
        const {
            className,
            type,
            width,
            height,
            unit,
            zoom,
            style,
            rulerStyle,
            backgroundColor,
            lineColor,
            textColor,
            direction,
            displayDragPos,
        } = this.props as Required&lt;GuidesProps>;
        return &lt;GuidesElement
            ref={ref(this, "manager")}
            className={`${prefix("manager", type)} ${className}`}
            style={style}
        >
            &lt;Ruler
                ref={ref(this, "ruler")}
                type={type}
                width={width}
                height={height}
                unit={unit}
                zoom={zoom}
                backgroundColor={backgroundColor}
                lineColor={lineColor}
                style={rulerStyle}
                textColor={textColor}
                direction={direction}
            />
            &lt;div className={GUIDES} ref={ref(this, "guidesElement")}>
                {displayDragPos &amp;&amp; &lt;div className={DISPLAY_DRAG} ref={ref(this, "displayElement")} />}
                &lt;div className={ADDER} ref={ref(this, "adderElement")} />
                {this.renderGuides()}
            &lt;/div>
        &lt;/GuidesElement>;
    }
    public renderGuides() {
        const { type, zoom } = this.props as Required&lt;GuidesProps>;
        const translateName = type === "horizontal" ? "translateY" : "translateX";
        const guides = this.state.guides;

        this.guideElements = [];
        return guides.map((pos, i) => {
            return (&lt;div className={prefix("guide", type)}
                ref={refs(this, "guideElements", i)}
                key={i}
                data-index={i}
                data-pos={pos}
                style={{
                    transform: `${translateName}(${pos * zoom}px)`,
                }}>&lt;/div>);
        });
    }
    public componentDidMount() {
        this.dragger = new Dragger(
            this.manager.getElement(), {
            container: document.body,
            dragstart: e => {
                const target = e.inputEvent.target;
                const datas = e.datas;

                if (target === this.ruler.canvasElement) {
                    e.datas.fromRuler = true;
                    datas.target = this.adderElement;
                } else if (!hasClass(target, GUIDE)) {
                    return false;
                } else {
                    datas.target = target;
                }
                this.onDragStart(e);
            },
            drag: this.onDrag,
            dragend: this.onDragEnd,
        },
        );
    }
    public componentWillUnmount() {
        this.dragger.unset();
    }
    /**
     * Load the current guidelines.
     * @memberof Guides
     * @instance
     */
    public loadGuides(guides: number[]) {
        this.setState({
            guides,
        });
    }
    /**
     * Get current guidelines.
     * @memberof Guides
     * @instance
     */
    public getGuides(): number[] {
        return this.state.guides;
    }
    /**
     * Scroll the positions of the guidelines opposite the ruler.
     * @memberof Guides
     * @instance
     */
    public scrollGuides(pos: number) {
        const { zoom } = this.props as Required&lt;GuidesProps>;
        const guidesElement = this.guidesElement;

        this.scrollPos = pos;
        guidesElement.style.transform = `${this.getTranslateName()}(${-pos * zoom}px)`;

        const guides = this.state.guides;
        this.guideElements.forEach((el, i) => {
            if (!el) {
                return;
            }
            el.style.display = -pos + guides[i] &lt; 0 ? "none" : "block";
        });
    }
    /**
     * Recalculate the size of the ruler.
     * @memberof Guides
     * @instance
     */
    public resize() {
        this.ruler.resize();
    }
    /**
     * Scroll the position of the ruler.
     * @memberof Guides
     * @instance
     */
    public scroll(pos: number) {
        this.ruler.scroll(pos);
    }
    private onDragStart = ({ datas, clientX, clientY, inputEvent }: any) => {
        const isHorizontal = this.props.type === "horizontal";
        const rect = this.guidesElement.getBoundingClientRect();
        datas.rect = rect;
        datas.offset = isHorizontal ? rect.top : rect.left;

        addClass(datas.target, DRAGGING);
        this.onDrag({ datas, clientX, clientY });

        inputEvent.stopPropagation();
        inputEvent.preventDefault();
    }
    private onDrag = ({ datas, clientX, clientY }: any) => {
        const { type, zoom, snaps, snapThreshold, displayDragPos, dragPosFormat } = this.props;
        const isHorizontal = type === "horizontal";
        let nextPos = Math.round((isHorizontal ? clientY : clientX) - datas.offset);
        let guidePos = Math.round(nextPos / zoom!);
        const guideSnaps = snaps!.slice().sort((a, b) => {
            return Math.abs(guidePos - a) - Math.abs(guidePos - b);
        });

        if (guideSnaps.length &amp;&amp; Math.abs(guideSnaps[0] - guidePos) &lt; snapThreshold!) {
            guidePos = guideSnaps[0];
            nextPos = guidePos * zoom!;
        }
        if (displayDragPos) {
            const rect = datas.rect;
            const displayPos = type === "horizontal"
                ? [clientX - rect.left, guidePos]
                : [guidePos, clientY - rect.top];
            this.displayElement.style.cssText += `display: block;transform: translate(-50%, -50%) translate(${
                displayPos.map(v => `${v}px`).join(", ")
            })`;
            this.displayElement.innerHTML = `${dragPosFormat!(guidePos)}`;
        }
        datas.target.setAttribute("data-pos", guidePos);
        datas.target.style.transform = `${this.getTranslateName()}(${nextPos}px)`;

        return nextPos;
    }
    private onDragEnd = ({ datas, clientX, clientY }: any) => {
        const pos = this.onDrag({ datas, clientX, clientY });
        const guides = this.state.guides;
        const { setGuides, onChangeGuides, zoom, displayDragPos } = this.props;
        const guidePos = Math.round(pos / zoom!);

        if (displayDragPos) {
            this.displayElement.style.cssText += `display: none;`;
        }
        removeClass(datas.target, DRAGGING);

         /**
         * The `changeGuides` event occurs when the guideline is added / removed / changed.
         * @memberof Guides
         * @event changeGuides
         * @param {OnChangeGuides} - Parameters for the changeGuides event
         */
        if (datas.fromRuler) {
            if (pos >= this.scrollPos &amp;&amp; guides.indexOf(guidePos) &lt; 0) {
                this.setState({
                    guides: [...guides, guidePos],
                }, () => {
                    onChangeGuides!({
                        guides: this.state.guides,
                    });
                    setGuides!(this.state.guides);
                });
            }
        } else {
            const index = datas.target.getAttribute("data-index");

            if (pos &lt; this.scrollPos) {
                guides.splice(index, 1);
            } else if (guides.indexOf(guidePos) > -1) {
                return;
            } else {
                guides[index] = guidePos;
            }
            this.setState({
                guides: [...guides],
            }, () => {
                setGuides!(this.state.guides);
            });
        }
    }
    private getTranslateName() {
        return this.props.type === "horizontal" ? "translateY" : "translateX";
    }
}
</code></pre>
        </article>
    </section>





<style>


nav li[file="packages/react-guides/src/react-guides/guides"]:after {
    display: none;
}
nav li[file="packages/react-guides/src/react-guides/guides"] h4, nav li[file="packages/react-guides/src/react-guides/guides"] ul {
    display: block;
}
</style>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/daybrush/jsdoc">JSDoc 0.3.7</a> on Fri May 15 2020 02:19:58 GMT+0900 (GMT+09:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/utils.min.js"></script>
<script src="scripts/search.js"></script>
<script src="scripts/custom.js"></script>
</body>
</html>
