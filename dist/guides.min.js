/*
Copyright (c) 2019 Daybrush
name: @scena/guides
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/guides.git
version: 0.7.2
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).Guides=n()}(this,function(){"use strict";var r=function(t,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function o(t,n){function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var s=function(){return(s=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function d(n,e){return function(t){t&&(n[e]=t)}}function e(e,r){return function(t){var n=t.prototype;e.forEach(function(t){r(n,t)})}}var m=function(){function t(){this.keys=[],this.values=[]}var n=t.prototype;return n.get=function(t){return this.values[this.keys.indexOf(t)]},n.set=function(t,n){var e=this.keys,r=this.values,i=e.indexOf(t),o=-1===i?e.length:i;e[o]=t,r[o]=n},t}(),b=function(){function t(){this.object={}}var n=t.prototype;return n.get=function(t){return this.object[t]},n.set=function(t,n){this.object[t]=n},t}(),_="function"==typeof Map,i=function(){function t(){}var n=t.prototype;return n.connect=function(t,n){this.prev=t,this.next=n,t&&(t.next=this),n&&(n.prev=this)},n.disconnect=function(){var t=this.prev,n=this.next;t&&(t.next=n),n&&(n.prev=t)},n.getIndex=function(){for(var t=this,n=-1;t;)t=t.prev,++n;return n},t}();var E=function(){function t(t,n,e,r,i,o,s,a){this.prevList=t,this.list=n,this.added=e,this.removed=r,this.changed=i,this.maintained=o,this.changedBeforeAdded=s,this.fixed=a}var n=t.prototype;return Object.defineProperty(n,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(n,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),n.caculateOrdered=function(){var t=function(t,e){var a=[],u=[];return t.forEach(function(t){var n=t[0],e=t[1],r=new i;a[n]=r,u[e]=r}),a.forEach(function(t,n){t.connect(a[n-1])}),t.filter(function(t,n){return!e[n]}).map(function(t,n){var e=t[0],r=t[1];if(e===r)return[0,0];var i=a[e],o=u[r-1],s=i.getIndex();return i.disconnect(),o?i.connect(o,o.next):i.connect(void 0,a[0]),[s,i.getIndex()]})}(this.changedBeforeAdded,this.fixed),a=this.changed,u=[];this.cacheOrdered=t.filter(function(t,n){var e=t[0],r=t[1],i=a[n],o=i[0],s=i[1];if(e!==r)return u.push([o,s]),!0}),this.cachePureChanged=u},t}();function c(t,n,e){var r=_?Map:e?b:m,i=e||function(t){return t},o=[],s=[],a=[],u=t.map(i),c=n.map(i),l=new r,h=new r,f=[],p=[],d={},v=[],g=0,y=0;return u.forEach(function(t,n){l.set(t,n)}),c.forEach(function(t,n){h.set(t,n)}),u.forEach(function(t,n){var e=h.get(t);void 0===e?(++y,s.push(n)):d[e]=y}),c.forEach(function(t,n){var e=l.get(t);void 0===e?(o.push(n),++g):(a.push([e,n]),y=d[n]||0,f.push([e-y,n-g]),p.push(n===e),e!==n&&v.push([e,n]))}),s.reverse(),new E(t,n,o,s,v,a,f,p)}var n="string",a="undefined";function u(t){return typeof t===n}function l(t,n,e,r){t.addEventListener(n,e,r)}function h(t,n,e){t.removeEventListener(n,e)}var f=function(t,n){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function p(t,n){function e(){this.constructor=t}f(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var v=function(){return(v=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function g(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(e[r[i]]=t[r[i]])}return e}function y(t,n){if(t===n)return!1;for(var e in t)if(!(e in n))return!0;for(var e in n)if(t[e]!==n[e])return!0;return!1}function P(i,o){var s=Object.keys(i),e=Object.keys(o),t=c(s,e,function(t){return t}),r={},a={},u={};return t.added.forEach(function(t){var n=e[t];r[n]=o[n]}),t.removed.forEach(function(t){var n=s[t];a[n]=i[n]}),t.maintained.forEach(function(t){var n=t[0],e=s[n],r=[i[e],o[e]];i[e]!==o[e]&&(u[e]=r)}),{added:r,removed:a,changed:u}}function O(t){t.forEach(function(t){t()})}function C(t){var n=0;return t.map(function(t){return null==t?"$compat"+ ++n:""+t})}function w(t,n,e,r){return u(t)?new z("text_"+t,n,e,r,null,{}):new("string"==typeof t.type?N:t.type.prototype.render?k:X)(t.type,n,e,r,t.ref,t.props)}function x(t){var n=[];return t.forEach(function(t){n=n.concat(function(t){return Array.isArray(t)}(t)?x(t):t)}),n}function D(t){var n=t.className,e=g(t,["className"]);return null!=n&&(e.class=n),delete e.style,delete e.children,e}function j(t,n){if(!n)return t;for(var e in n)typeof t[e]===a&&(t[e]=n[e]);return t}function S(t,n){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];var i=n||{},o=i.key,s=i.ref,a=g(i,["key","ref"]);return{type:t,key:o,ref:s,props:v(v({},a),{children:x(e).filter(function(t){return null!=t&&!1!==t})})}}var t=function(){function t(t,n,e,r,i,o){void 0===o&&(o={}),this.type=t,this.key=n,this.index=e,this.container=r,this.ref=i,this.props=o,this._providers=[]}var n=t.prototype;return n._should=function(t,n){return!0},n._update=function(t,n,e,r){if(this.base&&!u(n)&&!r&&!this._should(n.props,e))return!1;this.original=n,this._setState(e);var i=this.props;return u(n)||(this.props=n.props,this.ref=n.ref),this._render(t,this.base?i:{},e),!0},n._mounted=function(){var t=this.ref;t&&t(this.base)},n._setState=function(t){},n._updated=function(){var t=this.ref;t&&t(this.base)},n._destroy=function(){var t=this.ref;t&&t(null)},t}();function T(t){var n={},e={};for(var r in t)0===r.indexOf("on")?e[r.replace("on","").toLowerCase()]=t[r]:n[r]=t[r];return{attributes:n,events:e}}var z=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}p(n,t);var e=n.prototype;return e._render=function(t){var n=this,e=!this.base;return e&&(this.base=document.createTextNode(this.type.replace("text_",""))),t.push(function(){e?n._mounted():n._updated()}),!0},e._unmount=function(){this.base.parentNode.removeChild(this.base)},n}(t),N=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.events={},t}p(t,n);var e=t.prototype;return e.addEventListener=function(t,n){var e=this.events;e[t]=function(t){t.nativeEvent=t,n(t)},this.base.addEventListener(t,e[t])},e.removeEventListener=function(t){var n=this.events;this.base.removeEventListener(t,n[t]),delete n[t]},e._should=function(t){return y(this.props,t)},e._render=function(t,n){var e=this,r=!this.base;r&&(this.base=document.createElement(this.type)),F(this,this._providers,this.props.children,t,null);var i=this.base,o=T(n),s=o.attributes,a=o.events,u=T(this.props),c=u.attributes,l=u.events;return function(t,n,e){var r=P(t,n),i=r.added,o=r.removed,s=r.changed;for(var a in i)e.setAttribute(a,i[a]);for(var a in s)e.setAttribute(a,s[a][1]);for(var a in o)e.removeAttribute(a)}(D(s),D(c),i),function(t,n,e){var r=P(t,n),i=r.added,o=r.removed,s=r.changed;for(var a in o)e.removeEventListener(a);for(var a in i)e.addEventListener(a,i[a]);for(var a in s)e.removeEventListener(a),e.addEventListener(a,s[a][1]);for(var a in o)e.removeEventListener(a)}(a,l,this),function(t,n,e){var r=e.style,i=P(t,n),o=i.added,s=i.removed,a=i.changed;for(var u in o)r.setProperty?r.setProperty(u,o[u]):r[u]=o[u];for(var u in a)r.setProperty?r.setProperty(u,a[u][1]):r[u]=a[u][1];for(var u in s)r.removeProperty?r.removeProperty(u):r[u]=""}(n.style||{},this.props.style||{},i),t.push(function(){r?e._mounted():e._updated()}),!0},e._unmount=function(){var t=this.events,n=this.base;for(var e in t)n.removeEventListener(e,t[e]);this._providers.forEach(function(t){t._unmount()}),this.events={},n.parentNode.removeChild(n)},t}(t);function M(t){if(!t)return null;if(t instanceof Node)return t;var n=t._provider._providers;return n.length?M(n[0].base):null}var X=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}p(n,t);var e=n.prototype;return e._render=function(t){var n=this.type(this.props);return F(this,this._providers,n?[n]:[],t),!0},e._unmount=function(){this._providers.forEach(function(t){t._unmount()})},n}(t),Y=function(e){function t(t){var n=e.call(this,"container","container",0,null)||this;return n.base=t,n}p(t,e);var n=t.prototype;return n._render=function(){return!0},n._unmount=function(){},t}(t),k=function(s){function t(t,n,e,r,i,o){return void 0===o&&(o={}),s.call(this,t,n,e,r,i,j(o,t.defaultProps))||this}p(t,s);var n=t.prototype;return n._should=function(t,n){return this.base.shouldComponentUpdate(j(t,this.type.defaultProps),n||this.base.state)},n._render=function(t,n,e){var r=this;this.props=j(this.props,this.type.defaultProps);var i=!this.base;i?(this.base=new this.type(this.props),this.base._provider=this):this.base.props=this.props;var o=this.base,s=o.state,a=o.render();a&&a.props&&!a.props.children.length&&(a.props.children=this.props.children),F(this,this._providers,a?[a]:[],t,e,null),t.push(function(){i?(r._mounted(),o.componentDidMount()):(r._updated(),o.componentDidUpdate(n,s))})},n._setState=function(t){t&&(this.base.state=t)},n._unmount=function(){this._providers.forEach(function(t){t._unmount()}),this.base.componentWillUnmount()},t}(t),A=function(){function t(t){void 0===t&&(t={}),this.props=t,this.state={}}var n=t.prototype;return n.shouldComponentUpdate=function(t,n){return!0},n.render=function(){return null},n.setState=function(t,n,e){var r=[],i=this._provider;F(i.container,[i],[i.original],r,v(v({},this.state),t),e)&&(n&&r.push(n),O(r))},n.forceUpdate=function(t){this.setState(this.state,t,!0)},n.componentDidMount=function(){},n.componentDidUpdate=function(t,n){},n.componentWillUnmount=function(){},t}(),G=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return p(n,t),n.prototype.shouldComponentUpdate=function(t,n){return y(this.props,t)||y(this.state,n)},n}(A),L=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}p(n,t);var e=n.prototype;return e.componentDidMount=function(){var t=this.props,n=t.element,e=t.container;this._portalProvider=new Y(e),H(n,e,this._portalProvider)},e.componentDidUpdate=function(){var t=this.props;H(t.element,t.container,this._portalProvider)},e.componentWillUnmount=function(){H(null,this.props.container,this._portalProvider),this._portalProvider=null},n}(G);function R(i,s,o){var a=o.map(function(t){return u(t)?null:t.key}),t=c(C(s.map(function(t){return t.key})),C(a),function(t){return t});t.removed.forEach(function(t){s.splice(t,1)[0]._unmount()}),t.ordered.forEach(function(t){var n=t[0],e=t[1],r=s.splice(n,1)[0];s.splice(e,0,r);var i=M(r.base),o=M(s[e+1]&&s[e+1].base);i&&i.parentNode.insertBefore(i,o)}),t.added.forEach(function(t){s.splice(t,0,w(o[t],a[t],t,i))});var n=t.maintained.filter(function(t){t[0];var n=t[1],e=o[n],r=s[n];return(u(e)?"text_"+e:e.type)!==r.type?(r._unmount(),s.splice(n,1,w(e,a[n],n,i)),!0):(r.index=n,!1)});return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),i=0;for(n=0;n<e;n++)for(var o=arguments[n],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(t.added,n.map(function(t){t[0];return t[1]}))}function F(i,o,e,r,s,a){var t=R(i,o,e),n=o.filter(function(t,n){return t._update(r,e[n],s,a)}),u=function t(n){if(!n)return null;var e=n.base;return e instanceof Node?e:t(n.container)}(i);return u&&t.reverse().forEach(function(t){var n=o[t],e=M(n.base);if(e&&u!==e&&!e.parentNode){var r=function(t,n){for(var e=t._providers,r=e.length,i=n.index+1;i<r;++i){var o=M(e[i].base);if(o)return o}return null}(i,n);u.insertBefore(e,r)}}),0<n.length}function H(t,n,e){void 0===e&&(e=n.__REACT_COMPAT__);var r=!!e;return function(t,n,e){var r=[];F(t,t._providers,n,r,e),O(r)}(e=e||new Y(n),t?[t]:[]),r||(n.__REACT_COMPAT__=e),e}function U(t,n,e){var r=n.__REACT_COMPAT__;t&&!r&&(n.innerHTML=""),H(t,n,r),e&&e()}var I=["setGuides","type","width","height","rulerStyle","unit","zoom","style","backgroundColor","lineColor","snaps","snapThreshold","direction","container","className","textColor","displayDragPos","dragPosFormat"],B=["getGuides","loadGuides","scroll","scrollGuides","resize"],W=["changeGuides"],$=function(t,n){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};var q=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.state={scrollPos:0},t.width=0,t.height=0,t}!function(t,n){function e(){this.constructor=t}$(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(t,n);var e=t.prototype;return e.render=function(){return S("canvas",{ref:d(this,"canvasElement"),style:this.props.style})},e.componentDidMount=function(){var t=this.canvasElement.getContext("2d");this.canvasContext=t,this.resize()},e.componentDidUpdate=function(){this.resize()},e.scroll=function(t){this.draw(t)},e.resize=function(){var t=this.canvasElement,n=this.props,e=n.width,r=n.height;this.width=e||t.offsetWidth,this.height=r||t.offsetHeight,t.width=2*this.width,t.height=2*this.height,this.draw()},e.draw=function(t){void 0===t&&(t=this.state.scrollPos);var n=this.props,e=n.unit,r=n.zoom,i=n.type,o=n.backgroundColor,s=n.lineColor,a=n.textColor,u=n.direction,c=this.width,l=this.height;this.state.scrollPos=t;var h=this.canvasContext,f="horizontal"===i,p="start"===u;h.rect(0,0,2*c,2*l),h.fillStyle=o,h.fill(),h.save(),h.scale(2,2),h.strokeStyle=s,h.lineWidth=1,h.font="10px sans-serif",h.fillStyle=a,p&&(h.textBaseline="top"),h.translate(.5,0),h.beginPath();for(var d=f?c:l,v=r*e,g=Math.floor(t*r/v),y=Math.ceil((t*r+d)/v)-g,m=0;m<y;++m){var b=((m+g)*e-t)*r;if(-v<=b&&b<d){var _=f?[3+b,p?17:l-17]:[p?17:c-17,b-4],E=_[0],P=_[1];f?h.fillText(""+(m+g)*e,E,P):(h.save(),h.translate(E,P),h.rotate(-Math.PI/2),h.fillText(""+(m+g)*e,0,0),h.restore())}for(var O=0;O<10;++O){var C=b+O/10*v;if(!(C<0||d<=C)){var w=0===O?f?l:c:O%2==0?10:7,x=f?[C,p?0:l-w]:[p?0:c-w,C],D=x[0],j=x[1],S=f?[D,j+w]:[D+w,j],T=S[0],z=S[1];h.moveTo(D,j),h.lineTo(T,z)}}}h.stroke(),h.restore()},t.defaultProps={type:"horizontal",zoom:1,width:0,height:0,unit:50,direction:"end",style:{width:"100%",height:"100%"},backgroundColor:"#333333",textColor:"#ffffff",lineColor:"#777777"},t}(G),V=function(){return(V=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function J(t,n,e,r){var i=rt(t),o=rt(n),s=rt(r);return Q(it(r[0],ot(i,s)),it(r[0],ot(o,s)),e[0])}function K(t){return t.touches?nt(t.touches):[et(t)]}function Q(t,n,e){var r=t.clientX,i=t.clientY;return{clientX:r,clientY:i,deltaX:r-n.clientX,deltaY:i-n.clientY,distX:r-e.clientX,distY:i-e.clientY}}function Z(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function tt(t,e,r){return t.map(function(t,n){return Q(t,e[n],r[n])})}function nt(t){for(var n=Math.min(t.length,2),e=[],r=0;r<n;++r)e.push(et(t[r]));return e}function et(t){return{clientX:t.clientX,clientY:t.clientY}}function rt(t){return{clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function it(t,n){return{clientX:t.clientX+n.clientX,clientY:t.clientY+n.clientY}}function ot(t,n){return{clientX:t.clientX-n.clientX,clientY:t.clientY-n.clientY}}var st=function(){function t(t,n){var a=this;void 0===n&&(n={}),this.el=t,this.options={},this.flag=!1,this.pinchFlag=!1,this.datas={},this.isDrag=!1,this.isPinch=!1,this.isMouse=!1,this.isTouch=!1,this.prevClients=[],this.startClients=[],this.movement=0,this.startPinchClients=[],this.startDistance=0,this.customDist=[0,0],this.onDragStart=function(t){if(a.flag||!1!==t.cancelable){if(function(t){return t.touches&&2<=t.touches.length}(t)){if(!a.flag&&t.touches.length!==t.changedTouches.length)return;a.pinchFlag||a.onPinchStart(t)}if(!a.flag){var n=a.startClients[0]?a.startClients:K(t);a.customDist=[0,0],a.flag=!0,a.isDrag=!1,a.startClients=n,a.prevClients=n,a.datas={};var e=Q(n[a.movement=0],a.prevClients[0],a.startClients[0]),r=a.options,i=r.dragstart,o=r.preventRightClick,s=r.preventDefault;(o&&3===t.which||!1===(i&&i(V({datas:a.datas,inputEvent:t},e))))&&(a.startClients=[],a.prevClients=[],a.flag=!1),a.flag&&s&&t.preventDefault()}}},this.onDrag=function(t,n){if(a.flag){var e=K(t);a.pinchFlag&&a.onPinch(t,e);var r=a.move([0,0],t,e);if(r&&(r.deltaX||r.deltaY)){var i=a.options.drag;i&&i(V({},r,{isScroll:!!n,inputEvent:t}))}}},this.onDragEnd=function(t){if(a.flag){a.pinchFlag&&a.onPinchEnd(t),a.flag=!1;var n=a.options.dragend,e=a.prevClients,r=a.startClients,i=a.pinchFlag?J(e,e,r,a.startPinchClients):Q(e[0],e[0],r[0]);a.startClients=[],a.prevClients=[],n&&n(V({datas:a.datas,isDrag:a.isDrag,inputEvent:t},i))}},this.options=V({container:t,preventRightClick:!0,preventDefault:!0,pinchThreshold:0,events:["touch","mouse"]},n);var e=this.options,r=e.container,i=e.events;if(this.isTouch=-1<i.indexOf("touch"),this.isMouse=-1<i.indexOf("mouse"),this.customDist=[0,0],this.isMouse&&(l(t,"mousedown",this.onDragStart),l(r,"mousemove",this.onDrag),l(r,"mouseup",this.onDragEnd)),this.isTouch){var o={passive:!1};l(t,"touchstart",this.onDragStart,o),l(r,"touchmove",this.onDrag,o),l(r,"touchend",this.onDragEnd,o)}}var n=t.prototype;return n.isDragging=function(){return this.isDrag},n.isFlag=function(){return this.flag},n.isPinching=function(){return this.isPinch},n.scrollBy=function(n,e,t,r){void 0===r&&(r=!0),this.flag&&(this.startClients.forEach(function(t){t.clientX-=n,t.clientY-=e}),this.prevClients.forEach(function(t){t.clientX-=n,t.clientY-=e}),r&&this.onDrag(t,!0))},n.move=function(t,n,e){var r=t[0],i=t[1];void 0===e&&(e=this.prevClients);var o=this.customDist,s=this.prevClients,a=this.startClients,u=this.pinchFlag?J(e,s,a,this.startPinchClients):Q(e[0],s[0],a[0]);o[0]+=r,o[1]+=i,u.deltaX+=r,u.deltaY+=i;var c=u.deltaX,l=u.deltaY;return u.distX+=o[0],u.distY+=o[1],this.movement+=Math.sqrt(c*c+l*l),this.prevClients=e,this.isDrag=!0,V({datas:this.datas},u,{isScroll:!1,inputEvent:n})},n.onPinchStart=function(t){var n,e,r=this.options,i=r.pinchstart,o=r.pinchThreshold;if(!(this.isDrag&&this.movement>o)){var s=nt(t.changedTouches);if(this.pinchFlag=!0,(n=this.startClients).push.apply(n,s),(e=this.prevClients).push.apply(e,s),this.startDistance=Z(this.prevClients),this.startPinchClients=this.prevClients.slice(),i){var a=this.prevClients,u=rt(a),c=Q(u,u,u);i(V({datas:this.datas,touches:tt(a,a,a)},c,{inputEvent:t}))}}},n.onPinch=function(t,n){if(this.flag&&this.pinchFlag){this.isPinch=!0;var e=this.options.pinch;if(e){var r=this.prevClients,i=this.startClients,o=Q(rt(n),rt(r),rt(i)),s=Z(n);e(V({datas:this.datas,touches:tt(n,r,i),scale:s/this.startDistance,distance:s},o,{inputEvent:t}))}}},n.onPinchEnd=function(t){if(this.flag&&this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var e=this.options.pinchend;if(e){var r=this.prevClients,i=this.startClients,o=Q(rt(r),rt(r),rt(i));e(V({datas:this.datas,isPinch:n,touches:tt(r,r,i)},o,{inputEvent:t})),this.isPinch=!1,this.pinchFlag=!1}}},n.unset=function(){var t=this.el,n=this.options.container;this.isMouse&&(h(t,"mousedown",this.onDragStart),h(n,"mousemove",this.onDrag),h(n,"mouseup",this.onDragEnd)),this.isTouch&&(h(t,"touchstart",this.onDragStart),h(n,"touchmove",this.onDrag),h(n,"touchend",this.onDragEnd))},t}();var at=function(t){for(var n=5381,e=t.length;e;)n=33*n^t.charCodeAt(--e);return n>>>0};function ut(e,t,n){var r=document.createElement("style");return r.setAttribute("type","text/css"),r.innerHTML=t.replace(/([^}{]*){/gm,function(t,n){return function(t){var n=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return n?n.map(function(t){return t.trim()}):[]}(n).map(function(t){return-1<t.indexOf(":global")?t.replace(/\:global/g,""):-1<t.indexOf(":host")?""+t.replace(/\:host/g,"."+e):"."+e+" "+t}).join(", ")+"{"}),(n||document.head||document.body).appendChild(r),r}function ct(i){var o,s="rCS"+function(t){return at(t).toString(36)}(i),a=0;return{className:s,inject:function(t){var n,e=function(t){if(t.getRootNode){var n=t.getRootNode();if(11===n.nodeType)return n}}(t),r=0===a;return(e||r)&&(n=ut(s,i,e)),r&&(o=n),e||++a,{destroy:function(){e?(t.removeChild(n),n=null):(0<a&&--a,0===a&&o&&(o.parentNode.removeChild(o),o=null))}}}}}var lt=function(t,n){return(lt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};var ht=function(){return(ht=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};var ft=function(t,n){return(ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function pt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.map(function(t){return t.split(" ").map(function(t){return t?""+n+t:""}).join(" ")}).join(" ")}.apply(void 0,["scena-"].concat(t))}pt("ruler");var dt,vt,gt,yt=pt("guide","adder"),mt=pt("guides"),bt=pt("guide"),_t=pt("dragging"),Et=pt("display-drag"),Pt=(dt="scena-",'\n{\n    position: relative;\n}\ncanvas {\n    position: relative;\n}\n.guides {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n    z-index: 2000;\n}\n.display-drag {\n    position: absolute;\n    will-change: transform;\n    z-index: 2000;\n    font-weight: bold;\n    font-size: 12px;\n    display: none;\n    left: 20px;\n    top: -20px;\n    color: #f33;\n}\n:host.horizontal .guides {\n    width: 100%;\n    height: 0;\n    top: 30px;\n}\n:host.vertical .guides {\n    height: 100%;\n    width: 0;\n    left: 30px;\n}\n.guide {\n    position: absolute;\n    background: #f33;\n    z-index: 2;\n}\n.guide.dragging:before {\n    position: absolute;\n    content: "";\n    width: 100%;\n    height: 100%;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n:host.horizontal .guide {\n    width: 100%;\n    height: 1px;\n    cursor: row-resize;\n}\n:host.vertical .guide {\n    width: 1px;\n    height: 100%;\n    cursor: col-resize;\n}\n.mobile :host.horizontal .guide {\n    transform: scale(1, 2);\n}\n.mobile :host.vertical .guide {\n    transform: scale(2, 1);\n}\n:host.horizontal .guide:before {\n    height: 20px;\n}\n:host.vertical .guide:before {\n    width: 20px;\n}\n.adder {\n    display: none;\n}\n.adder.dragging {\n    display: block;\n}\n'.replace(/([^}{]*){/gm,function(t,n){return n.replace(/\.([^{,\s\d.]+)/g,"."+dt+"$1")+"{"})),Ot=(vt="div",gt=ct(Pt),function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return function(t,n){function e(){this.constructor=t}lt(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(n,t),n.prototype.render=function(){var t=this.props,n=t.className,e=void 0===n?"":n,r=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(e[r[i]]=t[r[i]])}return e}(t,["className"]);return S(vt,ht({ref:d(this,"element"),className:e+" "+gt.className},r))},n.prototype.componentDidMount=function(){this.injectResult=gt.inject(this.element)},n.prototype.componentWillUnmount=function(){this.injectResult.destroy(),this.injectResult=null},n.prototype.getElement=function(){return this.element},n}(A)),Ct=function(t){function n(){var y=null!==t&&t.apply(this,arguments)||this;return y.state={guides:[]},y.scrollPos=0,y.guideElements=[],y.onDragStart=function(t){var n=t.datas,e=t.clientX,r=t.clientY,i=t.inputEvent,o="horizontal"===y.props.type,s=y.guidesElement.getBoundingClientRect();n.rect=s,n.offset=o?s.top:s.left,function(t,n){t.classList?t.classList.add(n):t.className+=" "+n}(n.target,_t),y.onDrag({datas:n,clientX:e,clientY:r}),i.stopPropagation(),i.preventDefault()},y.onDrag=function(t){var n=t.datas,e=t.clientX,r=t.clientY,i=y.props,o=i.type,s=i.zoom,a=i.snaps,u=i.snapThreshold,c=i.displayDragPos,l=i.dragPosFormat,h="horizontal"===o,f=Math.round((h?r:e)-n.offset),p=Math.round(f/s),d=a.slice().sort(function(t,n){return Math.abs(p-t)-Math.abs(p-n)});if(d.length&&Math.abs(d[0]-p)<u&&(f=(p=d[0])*s),c){var v=n.rect,g="horizontal"===o?[e-v.left,p]:[p,r-v.top];y.displayElement.style.cssText+="display: block;transform: translate(-50%, -50%) translate("+g.map(function(t){return t+"px"}).join(", ")+")",y.displayElement.innerHTML=""+l(p)}return n.target.setAttribute("data-pos",p),n.target.style.transform=y.getTranslateName()+"("+f+"px)",f},y.onDragEnd=function(t){var n=t.datas,e=t.clientX,r=t.clientY,i=y.onDrag({datas:n,clientX:e,clientY:r}),o=y.state.guides,s=y.props,a=s.setGuides,u=s.onChangeGuides,c=s.zoom,l=s.displayDragPos,h=Math.round(i/c);if(l&&(y.displayElement.style.cssText+="display: none;"),function(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(\\s|^)"+n+"(\\s|$)");t.className=t.className.replace(e," ")}}(n.target,_t),n.fromRuler)i>=y.scrollPos&&o.indexOf(h)<0&&y.setState({guides:o.concat([h])},function(){u({guides:y.state.guides}),a(y.state.guides)});else{var f=n.target.getAttribute("data-index");if(i<y.scrollPos)o.splice(f,1);else{if(-1<o.indexOf(h))return;o[f]=h}y.setState({guides:o.slice()},function(){a(y.state.guides)})}},y}!function(t,n){function e(){this.constructor=t}ft(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}(n,t);var e=n.prototype;return e.render=function(){var t=this.props,n=t.className,e=t.type,r=t.width,i=t.height,o=t.unit,s=t.zoom,a=t.style,u=t.rulerStyle,c=t.backgroundColor,l=t.lineColor,h=t.textColor,f=t.direction,p=t.displayDragPos;return S(Ot,{ref:d(this,"manager"),className:pt("manager",e)+" "+n,style:a},S(q,{ref:d(this,"ruler"),type:e,width:r,height:i,unit:o,zoom:s,backgroundColor:c,lineColor:l,style:u,textColor:h,direction:f}),S("div",{className:mt,ref:d(this,"guidesElement")},p&&S("div",{className:Et,ref:d(this,"displayElement")}),S("div",{className:yt,ref:d(this,"adderElement")}),this.renderGuides()))},e.renderGuides=function(){var e=this,t=this.props,r=t.type,i=t.zoom,o="horizontal"===r?"translateY":"translateX",n=this.state.guides;return this.guideElements=[],n.map(function(t,n){return S("div",{className:pt("guide",r),ref:function(n,e,r){return function(t){t&&(n[e][r]=t)}}(e,"guideElements",n),key:n,"data-index":n,"data-pos":t,style:{transform:o+"("+t*i+"px)"}})})},e.componentDidMount=function(){var r=this;this.dragger=new st(this.manager.getElement(),{container:document.body,dragstart:function(t){var n=t.inputEvent.target,e=t.datas;if(n===r.ruler.canvasElement)t.datas.fromRuler=!0,e.target=r.adderElement;else{if(!function(t,n){return t.classList?t.classList.contains(n):!!t.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))}(n,bt))return!1;e.target=n}r.onDragStart(t)},drag:this.onDrag,dragend:this.onDragEnd})},e.componentWillUnmount=function(){this.dragger.unset()},e.loadGuides=function(t){this.setState({guides:t})},e.getGuides=function(){return this.state.guides},e.scrollGuides=function(e){var t=this.props.zoom,n=this.guidesElement;this.scrollPos=e,n.style.transform=this.getTranslateName()+"("+-e*t+"px)";var r=this.state.guides;this.guideElements.forEach(function(t,n){t&&(t.style.display=-e+r[n]<0?"none":"block")})},e.resize=function(){this.ruler.resize()},e.scroll=function(t){this.ruler.scroll(t)},e.getTranslateName=function(){return"horizontal"===this.props.type?"translateY":"translateX"},n.defaultProps={className:"",type:"horizontal",setGuides:function(){},zoom:1,style:{width:"100%",height:"100%"},snapThreshold:5,snaps:[],onChangeGuides:function(){},displayDragPos:!1,dragPosFormat:function(t){return t}},n}(G),wt=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n.state=n.props,n}return o(t,e),t.prototype.render=function(){var t=this.state,n=t.container,e=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(e[r[i]]=t[r[i]])}return e}(t,["container"]);return function(t,n){return S(L,{element:t,container:n})}(S(Ct,s({ref:d(this,"guides")},e)),n)},t}(A);function xt(t){return void 0===t}var Dt=function(i){function t(t,n){void 0===n&&(n={});var e=i.call(this)||this;e.tempElement=document.createElement("div");var r={};return W.forEach(function(n){r[function(t){return t.replace(/[\s-_]([a-z])/g,function(t,n){return n.toUpperCase()})}("on "+n)]=function(t){return e.trigger(n,t)}}),U(S(wt,s({},n,r,{container:t,ref:d(e,"innerGuides")})),e.tempElement),e}o(t,i);var n=t.prototype;return n.setState=function(t,n){this.innerGuides.setState(t,n)},n.destroy=function(){U(null,this.tempElement),this.tempElement=null,this.innerGuides=null},n.getPreactGuides=function(){return this.innerGuides.guides},t=function(t,n,e,r){var i,o=arguments.length,s=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,r);else for(var a=t.length-1;0<=a;a--)(i=t[a])&&(s=(o<3?i(s):3<o?i(n,e,s):i(n,e))||s);return 3<o&&s&&Object.defineProperty(n,e,s),s}([e(B,function(t,r){t[r]||(t[r]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=this.getPreactGuides();if(e&&e[r])return e[r].apply(e,t)})}),e(I,function(t,e){Object.defineProperty(t,e,{get:function(){return this.getPreactGuides().props[e]},set:function(t){var n;this.innerGuides.setState(((n={})[e]=t,n))},enumerable:!0,configurable:!0})})],t)}(function(){var t=function(){function t(){this._eventHandler={},this.options={}}var n=t.prototype;return n.trigger=function(t,n){void 0===n&&(n={});var e=this._eventHandler[t]||[];if(!(0<e.length))return!0;e=e.concat(),n.eventType=t;var r=!1,i=[n],o=0;n.stop=function(){r=!0},n.currentTarget=this;for(var s=arguments.length,a=new Array(2<s?s-2:0),u=2;u<s;u++)a[u-2]=arguments[u];for(1<=a.length&&(i=i.concat(a)),o=0;e[o];o++)e[o].apply(this,i);return!r},n.once=function(i,o){if("object"==typeof i&&xt(o)){var t,n=i;for(t in n)this.once(t,n[t]);return this}if("string"==typeof i&&"function"==typeof o){var s=this;this.on(i,function t(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];o.apply(s,e),s.off(i,t)})}return this},n.hasOn=function(t){return!!this._eventHandler[t]},n.on=function(t,n){if("object"==typeof t&&xt(n)){var e,r=t;for(e in r)this.on(e,r[e]);return this}if("string"==typeof t&&"function"==typeof n){var i=this._eventHandler[t];xt(i)&&(this._eventHandler[t]=[],i=this._eventHandler[t]),i.push(n)}return this},n.off=function(t,n){if(xt(t))return this._eventHandler={},this;if(xt(n)){if("string"==typeof t)return this._eventHandler[t]=void 0,this;var e,r=t;for(e in r)this.off(e,r[e]);return this}var i,o,s=this._eventHandler[t];if(s)for(i=0;void 0!==(o=s[i]);i++)if(o===n){s=s.splice(i,1);break}return this},t}();return t.VERSION="2.1.2",t}()),jt={__proto__:null,default:Dt,PROPERTIES:I,METHODS:B,EVENTS:W};for(var St in jt)Dt[St]=jt[St];return Dt});
//# sourceMappingURL=guides.min.js.map
